<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>
    <!-- Meta Tags for Sharing -->
    <meta name="description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta property="og:title" content="Finance Tracker">
    <meta property="og:description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta property="og:image" content=""> <!-- Replace with the URL to an image representing your app -->
    <meta property="og:url" content=""> <!-- Replace with your website URL -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Finance Tracker">
    <meta name="twitter:description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta name="twitter:image" content=""> <!-- Replace with the URL to an image representing your app -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Data Labels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .navbar {
            margin-bottom: 20px;
        }
        .active-btn {
            background-color: #007BFF !important;
            font-weight: bold;
            color: white !important;
        }
        .highlight-row {
            background-color: #c3e6cb !important;
        }
        .card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #007BFF;
            color: white;
            border-radius: 8px 8px 0 0;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .summary-card {
            background: linear-gradient(to right, #007BFF, #0056b3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .summary-text {
            flex: 1;
            max-width: 100%;
            margin-bottom: 10px;
        }
        .chart-container {
            flex: 1;
            max-width: 100%;
            display: flex;
            justify-content: center;
        }
        .current-income-display {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #007BFF;
        }
        .gradient-text {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(to right, #007BFF, #0056b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
        }
        .expenses-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 0;
        }
        .expenses-card .card-body {
            padding: 0;
        }
        .expenses-card .card-header {
            background-color: #007BFF;
            color: white;
            border-radius: 8px 8px 0 0;
            padding: 10px;
        }
        .expenses-card .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        .expenses-table th {
            background-color: #007BFF;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .expenses-table td, .expenses-table th {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        /* Media Queries for Mobile */
        @media (max-width: 576px) {
            .summary-card {
                flex-direction: column;
                align-items: flex-start;
            }
            .summary-text, .chart-container {
                max-width: 100%;
                margin-bottom: 10px;
            }
            .card-title {
                font-size: 1.25rem;
            }
            .gradient-text {
                font-size: 2rem;
            }
        }

        /* Responsive Table */
        .expenses-table {
            width: 100%;
            overflow-x: auto;
            display: block;
            border-collapse: collapse;
        }

        /* Mobile-specific styles */
        @media (max-width: 576px) {
            .expenses-table th, .expenses-table td {
                white-space: nowrap;
            }

            .expenses-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px;
            }

            .expenses-table td:last-child {
                flex: 1;
                justify-content: flex-end;
            }

            .expenses-table th, .expenses-table td {
                text-align: left;
            }

            .expenses-table .btn, .expenses-table input[type="checkbox"] {
                margin: 0 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Month Navigation -->
        <div id="monthNavbar" class="d-flex justify-content-center flex-wrap mb-4"></div>

        <h1 class="text-center gradient-text">Finance Tracker</h1>

        <!-- Summary Section -->
        <div class="summary-card">
            <div class="summary-text">
                <h4>Summary</h4>
                <p><strong>Total Expenses:</strong> $<span id="totalExpenses">0.00</span></p>
                <p><strong>Total Paid:</strong> $<span id="totalPaid">0.00</span></p>
                <p><strong>Remaining Balance:</strong> $<span id="remainingBalance">0.00</span></p>
            </div>
            <div class="chart-container">
                <canvas id="expenseChart" style="max-width: 400px; max-height: 400px;"></canvas>
            </div>
        </div>

        <!-- Main Row -->
        <div class="row">
            <!-- Add New Expense -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title text-center mb-0">
                            <button class="btn btn-link text-decoration-none text-white" data-bs-toggle="collapse" data-bs-target="#addExpenseCollapse" aria-expanded="false" aria-controls="addExpenseCollapse" id="toggleExpenseButton">
                                Add New Expense <i class="fas fa-chevron-down toggle-icon"></i>
                            </button>
                        </h3>
                    </div>
                    <div id="addExpenseCollapse" class="collapse">
                        <div class="card-body">
                            <form>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newItem" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter the name of the expense.">Expense Item <span class="text-danger">*</span></label>
                                        <input type="text" id="newItem" class="form-control" placeholder="e.g., Coffee Subscription" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="newAmount" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter the amount in dollars.">Amount ($) <span class="text-danger">*</span></label>
                                        <input type="number" id="newAmount" class="form-control" placeholder="e.g., 9.99" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newDueDate" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Select the due date for the expense.">Due Date <span class="text-danger">*</span></label>
                                        <input type="date" id="newDueDate" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="newCategory" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Choose a category for the expense.">Category <span class="text-danger">*</span></label>
                                        <select id="newCategory" class="form-select">
                                            <option value="Bills">Bills</option>
                                            <option value="Savings">Savings</option>
                                            <option value="Personal Expenses">Personal Expenses</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newFrequency" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Select how often this expense occurs.">Frequency <span class="text-danger">*</span></label>
                                        <select id="newFrequency" class="form-select">
                                            <option value="Weekly">Weekly</option>
                                            <option value="Bi-Weekly">Bi-Weekly</option>
                                            <option value="Monthly" selected>Monthly</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button id="addExpenseButton" class="btn btn-primary">Add Expense</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Update Monthly Income -->
            <div class="col-md-4">
                <div class="update-income-card card">
                    <div class="card-header">
                        <h3 class="card-title text-center mb-0">
                            <button class="btn btn-link text-decoration-none text-white" data-bs-toggle="collapse" data-bs-target="#updateIncomeCollapse" aria-expanded="false" aria-controls="updateIncomeCollapse" id="toggleIncomeButton">
                                Update Monthly Income <i class="fas fa-chevron-down toggle-icon"></i>
                            </button>
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Display total income outside the collapsible section -->
                        <div class="current-income-display mb-3">
                            Total Monthly Income: <span id="currentIncome">$0.00</span>
                        </div>
                    </div>
                    <div id="updateIncomeCollapse" class="collapse">
                        <div class="card-body">
                            <button class="btn btn-primary w-100 mb-3" data-bs-toggle="modal" data-bs-target="#addIncomeSourceModal">Add Income Source</button>
                            <ul id="incomeSourceList" class="list-group mb-3"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expense Table -->
        <div class="expenses-card card">
            <div class="card-header">
                <h3 class="card-title">Expenses</h3>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-striped table-hover expenses-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Frequency</th>
                            <th>Paid</th>
                            <th>Action</th>
                            <th>Skip</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Add Income Source Modal -->
        <div class="modal fade" id="addIncomeSourceModal" tabindex="-1" aria-labelledby="addIncomeSourceModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addIncomeSourceModalLabel">Add Income Source</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="incomeSourceForm">
                            <div class="mb-3">
                                <label for="incomeSourceName" class="form-label">Income Source Name</label>
                                <input type="text" class="form-control" id="incomeSourceName" required>
                            </div>
                            <div class="mb-3">
                                <label for="incomeSourceAmount" class="form-label">Amount ($)</label>
                                <input type="number" class="form-control" id="incomeSourceAmount" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Income Source</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let currentMonthIndex = 0;

        // Initialize data with income sources
        const savedData = JSON.parse(localStorage.getItem('financeData'));
        const dataByMonth = savedData || Array.from({ length: 12 }, () => ({
            incomeSources: [], // Ensure this is initialized as an empty array
            expenses: [],
        }));

        let expenseChart;

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('financeData', JSON.stringify(dataByMonth));
        }

        // Render month navbar
        function renderMonthNavbar() {
            const navbar = document.getElementById("monthNavbar");
            navbar.innerHTML = "";

            months.forEach((month, index) => {
                const button = document.createElement("button");
                button.textContent = month;
                button.classList.add("btn", "btn-outline-primary", "m-1");
                if (index === currentMonthIndex) {
                    button.classList.add("active-btn");
                }
                button.onclick = () => switchMonth(index);
                navbar.appendChild(button);
            });
        }

        // Switch month
        function switchMonth(index) {
            currentMonthIndex = index;
            renderMonthNavbar();
            renderExpensesTable();
            updateSummary();
        }

        // Render expenses table
        function renderExpensesTable() {
            const tableBody = document.getElementById("expensesTable");
            tableBody.innerHTML = "";

            const currentData = dataByMonth[currentMonthIndex];
            currentData.expenses.forEach((expense, idx) => {
                const row = document.createElement("tr");
                const dueDate = new Date(expense.dueDate);
                const dayOfMonth = dueDate.getDate();

                row.innerHTML = `
                    <td>${expense.item}</td>
                    <td>${expense.category}</td>
                    <td>$${expense.amount.toFixed(2)}</td>
                    <td>${dayOfMonth}</td>
                    <td>${expense.frequency}</td>
                    <td><input type="checkbox" ${expense.paid ? "checked" : ""} onclick="togglePaid(${idx})"></td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteExpense(${idx})">Delete</button></td>
                    <td><input type="checkbox" ${expense.skipped ? "checked" : ""} onclick="toggleSkip(${idx})"></td>
                `;
                if (expense.paid) {
                    row.classList.add("highlight-row");
                }
                tableBody.appendChild(row);
            });
        }

        // Add new expense
        document.getElementById("addExpenseButton").onclick = (e) => {
            e.preventDefault();
            const item = document.getElementById("newItem").value;
            const amount = parseFloat(document.getElementById("newAmount").value);
            const dueDate = document.getElementById("newDueDate").value;
            const category = document.getElementById("newCategory").value;
            const frequency = document.getElementById("newFrequency").value;

            if (!item || isNaN(amount) || !dueDate || !category || !frequency) {
                alert("Please fill out all fields!");
                return;
            }

            let occurrences = 1;
            let interval = 0;
            if (frequency === 'Weekly') {
                occurrences = 4;
                interval = 7;
            } else if (frequency === 'Bi-Weekly') {
                occurrences = 2;
                interval = 14;
            }

            for (let i = 0; i < occurrences; i++) {
                const newDueDate = new Date(dueDate);
                newDueDate.setDate(newDueDate.getDate() + i * interval);
                const formattedDueDate = newDueDate.toISOString().split('T')[0];

                const newExpense = { 
                    item, 
                    amount, 
                    dueDate: formattedDueDate, 
                    category, 
                    frequency, 
                    paid: false, 
                    skipped: false 
                };
                dataByMonth[currentMonthIndex].expenses.push(newExpense);
            }

            renderExpensesTable();
            updateSummary();
            saveData();
        };

        // Delete expense
        function deleteExpense(index) {
            dataByMonth[currentMonthIndex].expenses.splice(index, 1);
            renderExpensesTable();
            updateSummary();
            saveData();
        }

        // Toggle paid status
        function togglePaid(index) {
            const expense = dataByMonth[currentMonthIndex].expenses[index];
            expense.paid = !expense.paid;
            if (expense.paid) {
                expense.skipped = false;
            }
            renderExpensesTable();
            updateSummary();
            saveData();
        }

        // Toggle skip status
        function toggleSkip(index) {
            const expense = dataByMonth[currentMonthIndex].expenses[index];
            expense.skipped = !expense.skipped;
            if (expense.skipped) {
                expense.paid = false;
            }
            renderExpensesTable();
            updateSummary();
            saveData();
        }

        // Render income sources
        function renderIncomeSources() {
            const incomeSourceList = document.getElementById("incomeSourceList");
            incomeSourceList.innerHTML = "";

            const currentData = dataByMonth[currentMonthIndex];
            currentData.incomeSources.forEach((source, idx) => {
                const listItem = document.createElement("li");
                listItem.className = "list-group-item d-flex justify-content-between align-items-center";
                listItem.innerHTML = `
                    ${source.name}: $${source.amount.toFixed(2)}
                    <button class="btn btn-danger btn-sm" onclick="removeIncomeSource(${idx})">Remove</button>
                `;
                incomeSourceList.appendChild(listItem);
            });
        }

        // Add new income source
        document.getElementById("incomeSourceForm").onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById("incomeSourceName").value;
            const amount = parseFloat(document.getElementById("incomeSourceAmount").value);

            if (!name || isNaN(amount) || amount <= 0) {
                alert("Please enter a valid income source and amount!");
                return;
            }

            const newIncomeSource = { name, amount };
            if (!dataByMonth[currentMonthIndex].incomeSources) {
                dataByMonth[currentMonthIndex].incomeSources = [];
            }
            dataByMonth[currentMonthIndex].incomeSources.push(newIncomeSource);

            updateIncomeDisplay();
            saveData();
            document.getElementById("incomeSourceForm").reset();
            bootstrap.Modal.getInstance(document.getElementById('addIncomeSourceModal')).hide();
        };

        // Remove income source
        function removeIncomeSource(index) {
            dataByMonth[currentMonthIndex].incomeSources.splice(index, 1);
            updateIncomeDisplay();
            saveData();
        }

        // Update income display
        function updateIncomeDisplay() {
            const currentData = dataByMonth[currentMonthIndex];
            const totalIncome = currentData.incomeSources.reduce((sum, source) => sum + source.amount, 0);
            document.getElementById("currentIncome").textContent = `$${totalIncome.toFixed(2)}`;
            renderIncomeSources();
            updateSummary();
        }

        // Update summary
        function updateSummary() {
            const currentData = dataByMonth[currentMonthIndex];
            const totalIncome = currentData.incomeSources.reduce((sum, source) => sum + source.amount, 0);

            const totalExpenses = currentData.expenses.reduce((sum, expense) => {
                if (expense.skipped) return sum;
                return sum + expense.amount;
            }, 0);

            const totalPaid = currentData.expenses.reduce((sum, expense) => sum + (expense.paid ? expense.amount : 0), 0);
            const remainingBalance = totalIncome - totalExpenses;

            document.getElementById("totalExpenses").textContent = totalExpenses.toFixed(2);
            document.getElementById("totalPaid").textContent = totalPaid.toFixed(2);
            document.getElementById("remainingBalance").textContent = remainingBalance.toFixed(2);
            document.getElementById("currentIncome").textContent = `$${totalIncome.toFixed(2)}`;

            updateExpenseChart();
        }

        // Update expense chart
        function updateExpenseChart() {
            const currentData = dataByMonth[currentMonthIndex];
            const categoryTotals = currentData.expenses.reduce((acc, expense) => {
                if (!expense.skipped) {
                    acc[expense.category] = (acc[expense.category] || 0) + expense.amount;
                }
                return acc;
            }, {});

            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);

            if (expenseChart) {
                expenseChart.destroy();
            }

            const ctx = document.getElementById('expenseChart').getContext('2d');
            expenseChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'white',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(2);
                                    return `${label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            formatter: (value, context) => {
                                return `$${value.toFixed(2)}`;
                            },
                            color: 'white',
                            font: {
                                weight: 'bold'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Expense Distribution by Category',
                            color: 'white',
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderMonthNavbar();
            renderExpensesTable();
            updateIncomeDisplay();
            updateSummary();

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('newDueDate').value = today;

            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(button => {
                button.addEventListener('click', function() {
                    const icon = this.querySelector('.toggle-icon');
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';

                    if (isExpanded) {
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    } else {
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    }
                });
            });
        });
    </script>
</body>
</html>
