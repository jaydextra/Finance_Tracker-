<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>
    <!-- Meta Tags for Sharing -->
    <meta name="description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta property="og:title" content="Finance Tracker">
    <meta property="og:description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta property="og:image" content=""> <!-- Replace with the URL to an image representing your app -->
    <meta property="og:url" content=""> <!-- Replace with your website URL -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Finance Tracker">
    <meta name="twitter:description" content="A comprehensive finance tracker to manage your expenses and income effectively.">
    <meta name="twitter:image" content=""> <!-- Replace with the URL to an image representing your app -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .navbar {
            margin-bottom: 20px;
        }
        .active-btn {
            background-color: #007BFF !important;
            font-weight: bold;
            color: white !important;
        }
        .highlight-row {
            background-color: #d4edda !important;
        }
        .card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #007BFF;
            color: white;
            border-radius: 8px 8px 0 0;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .summary-card {
            background: linear-gradient(to right, #007BFF, #0056b3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .summary-text {
            flex: 1;
            max-width: 100%;
            margin-bottom: 10px;
        }
        .chart-container {
            flex: 1;
            max-width: 100%;
            display: flex;
            justify-content: center;
        }
        .current-income-display {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #007BFF;
        }
        .gradient-text {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(to right, #007BFF, #0056b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
        }
        .expenses-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .expenses-table th {
            background-color: #007BFF;
            color: white;
        }
        .expenses-table td, .expenses-table th {
            padding: 12px;
            text-align: center;
        }

        /* Media Queries for Mobile */
        @media (max-width: 576px) {
            .summary-card {
                flex-direction: column;
                align-items: flex-start;
            }
            .summary-text, .chart-container {
                max-width: 100%;
                margin-bottom: 10px;
            }
            .card-title {
                font-size: 1.25rem;
            }
            .gradient-text {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Month Navigation -->
        <div id="monthNavbar" class="d-flex justify-content-center flex-wrap mb-4"></div>

        <h1 class="text-center gradient-text">Finance Tracker</h1>

        <!-- Summary Section -->
        <div class="summary-card">
            <div class="summary-text">
                <h4>Summary</h4>
                <p><strong>Total Expenses:</strong> $<span id="totalExpenses">0.00</span></p>
                <p><strong>Total Paid:</strong> $<span id="totalPaid">0.00</span></p>
                <p><strong>Remaining Balance:</strong> $<span id="remainingBalance">0.00</span></p>
            </div>
            <div class="chart-container">
                <canvas id="expenseChart" style="max-width: 400px; max-height: 400px;"></canvas>
            </div>
        </div>

        <!-- Main Row -->
        <div class="row">
            <!-- Add New Expense -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title text-center mb-0">
                            <button class="btn btn-link text-decoration-none text-white" data-bs-toggle="collapse" data-bs-target="#addExpenseCollapse" aria-expanded="false" aria-controls="addExpenseCollapse" id="toggleExpenseButton">
                                Add New Expense <i class="fas fa-chevron-down toggle-icon"></i>
                            </button>
                        </h3>
                    </div>
                    <div id="addExpenseCollapse" class="collapse">
                        <div class="card-body">
                            <form>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newItem" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter the name of the expense.">Expense Item <span class="text-danger">*</span></label>
                                        <input type="text" id="newItem" class="form-control" placeholder="e.g., Coffee Subscription" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="newAmount" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter the amount in dollars.">Amount ($) <span class="text-danger">*</span></label>
                                        <input type="number" id="newAmount" class="form-control" placeholder="e.g., 9.99" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newDueDate" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Select the due date for the expense.">Due Date <span class="text-danger">*</span></label>
                                        <input type="date" id="newDueDate" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="newCategory" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Choose a category for the expense.">Category <span class="text-danger">*</span></label>
                                        <select id="newCategory" class="form-select">
                                            <option value="Bills">Bills</option>
                                            <option value="Savings">Savings</option>
                                            <option value="Personal Expenses">Personal Expenses</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="newFrequency" class="form-label" data-bs-toggle="tooltip" data-bs-placement="top" title="Select how often this expense occurs.">Frequency <span class="text-danger">*</span></label>
                                        <select id="newFrequency" class="form-select">
                                            <option value="Weekly">Weekly</option>
                                            <option value="Bi-Weekly">Bi-Weekly</option>
                                            <option value="Monthly">Monthly</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button id="addExpenseButton" class="btn btn-primary">Add Expense</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Update Monthly Income -->
            <div class="col-md-4">
                <div class="update-income-card card">
                    <div class="card-header">
                        <h3 class="card-title text-center mb-0">
                            <button class="btn btn-link text-decoration-none text-white" data-bs-toggle="collapse" data-bs-target="#updateIncomeCollapse" aria-expanded="false" aria-controls="updateIncomeCollapse" id="toggleIncomeButton">
                                Update Monthly Income <i class="fas fa-chevron-down toggle-icon"></i>
                            </button>
                        </h3>
                    </div>
                    <div id="updateIncomeCollapse" class="collapse">
                        <div class="card-body">
                            <div class="current-income-display">
                                Current Income: <span id="currentIncome">$0.00</span>
                            </div>
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fas fa-wallet"></i></span>
                                <input type="number" id="incomeInput" class="form-control" placeholder="Enter monthly income">
                            </div>
                            <button id="updateIncomeButton" class="btn btn-primary w-100">Save Income</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expense Table -->
        <div class="expenses-card card">
            <div class="card-body">
                <h3 class="card-title">Expenses</h3>
                <table class="table table-bordered expenses-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Frequency</th>
                            <th>Paid</th>
                            <th>Action</th>
                            <th>Skip</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let currentMonthIndex = 0;

        // Load data from localStorage or initialize with default values
        const savedData = JSON.parse(localStorage.getItem('financeData'));
        const dataByMonth = savedData || Array.from({ length: 12 }, () => ({
            income: 0,
            expenses: [],
        }));

        let expenseChart;

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('financeData', JSON.stringify(dataByMonth));
        }

        // Render month navbar
        function renderMonthNavbar() {
            const navbar = document.getElementById("monthNavbar");
            navbar.innerHTML = "";

            months.forEach((month, index) => {
                const button = document.createElement("button");
                button.textContent = month;
                button.classList.add("btn", "btn-outline-primary", "m-1");
                if (index === currentMonthIndex) {
                    button.classList.add("active-btn");
                }
                button.onclick = () => switchMonth(index);
                navbar.appendChild(button);
            });
        }

        // Switch month
        function switchMonth(index) {
            currentMonthIndex = index;
            renderMonthNavbar();
            renderExpensesTable();
            updateSummary();
        }

        // Render expenses table
        function renderExpensesTable() {
            const tableBody = document.getElementById("expensesTable");
            tableBody.innerHTML = "";

            const currentData = dataByMonth[currentMonthIndex];
            currentData.expenses.forEach((expense, idx) => {
                const row = document.createElement("tr");
                
                // Extract the day of the month from the due date
                const dueDate = new Date(expense.dueDate);
                const dayOfMonth = dueDate.getDate(); // Get the day of the month

                row.innerHTML = `
                    <td>${expense.item}</td>
                    <td>${expense.category}</td>
                    <td>$${expense.amount.toFixed(2)}</td>
                    <td>${dayOfMonth}</td>
                    <td>${expense.frequency}</td>
                    <td><input type="checkbox" ${expense.paid ? "checked" : ""} onclick="togglePaid(${idx})"></td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteExpense(${idx})">Delete</button></td>
                    <td><input type="checkbox" ${expense.skipped ? "checked" : ""} onclick="toggleSkip(${idx})"></td>
                `;
                if (expense.paid) {
                    row.classList.add("highlight-row");
                }
                tableBody.appendChild(row);
            });
        }

        // Add new expense
        document.getElementById("addExpenseButton").onclick = (e) => {
            e.preventDefault();
            const item = document.getElementById("newItem").value;
            const amount = parseFloat(document.getElementById("newAmount").value);
            const dueDate = document.getElementById("newDueDate").value;
            const category = document.getElementById("newCategory").value;
            const frequency = document.getElementById("newFrequency").value;

            if (!item || isNaN(amount) || !dueDate || !category || !frequency) {
                alert("Please fill out all fields!");
                return;
            }

            const newExpense = { item, amount, dueDate, category, frequency, paid: false, skipped: false };
            dataByMonth[currentMonthIndex].expenses.push(newExpense);

            // Carry expenses to future months
            for (let i = currentMonthIndex + 1; i < 12; i++) {
                dataByMonth[i].expenses.push({ ...newExpense });
            }

            renderExpensesTable();
            updateSummary();
            saveData(); // Save changes
        };

        // Delete expense
        function deleteExpense(index) {
            // Remove the expense from the current month
            dataByMonth[currentMonthIndex].expenses.splice(index, 1);

            // Remove the expense from all subsequent months
            for (let i = currentMonthIndex + 1; i < 12; i++) {
                dataByMonth[i].expenses.splice(index, 1);
            }

            renderExpensesTable();
            updateSummary();
            saveData(); // Save changes
        }

        // Toggle paid status
        function togglePaid(index) {
            const expense = dataByMonth[currentMonthIndex].expenses[index];
            expense.paid = !expense.paid;
            if (expense.paid) {
                expense.skipped = false; // Uncheck skip if paid is checked
            }
            renderExpensesTable();
            updateSummary();
            saveData(); // Save changes
        }

        // Toggle skip status
        function toggleSkip(index) {
            const expense = dataByMonth[currentMonthIndex].expenses[index];
            expense.skipped = !expense.skipped;
            if (expense.skipped) {
                expense.paid = false; // Uncheck paid if skip is checked
            }
            renderExpensesTable();
            updateSummary();
            saveData(); // Save changes
        }

        // Update summary
        function updateSummary() {
            const currentData = dataByMonth[currentMonthIndex];
            const year = new Date().getFullYear();
            const month = currentMonthIndex; // 0-indexed month
            const daysInMonth = new Date(year, month + 1, 0).getDate(); // Get the number of days in the current month

            const totalExpenses = currentData.expenses.reduce((sum, expense) => {
                if (expense.skipped) return sum;

                let expenseAmount = expense.amount;
                const dueDate = new Date(expense.dueDate);
                const startDay = dueDate.getDate();

                switch (expense.frequency) {
                    case 'Weekly':
                        if (currentMonthIndex === dueDate.getMonth()) {
                            // First month: calculate from the start day
                            const weeksInMonth = Math.floor((daysInMonth - startDay) / 7) + 1;
                            expenseAmount *= weeksInMonth;
                        } else {
                            // Subsequent months: calculate full weeks
                            const fullWeeksInMonth = Math.floor(daysInMonth / 7);
                            expenseAmount *= fullWeeksInMonth;
                        }
                        break;
                    case 'Bi-Weekly':
                        if (currentMonthIndex === dueDate.getMonth()) {
                            // First month: calculate from the start day
                            const biWeeksInMonth = Math.floor((daysInMonth - startDay) / 14) + 1;
                            expenseAmount *= biWeeksInMonth;
                        } else {
                            // Subsequent months: calculate full bi-weekly periods
                            const fullBiWeeksInMonth = Math.floor(daysInMonth / 14);
                            expenseAmount *= fullBiWeeksInMonth;
                        }
                        break;
                    case 'Monthly':
                        // No change needed for monthly
                        break;
                }

                return sum + expenseAmount;
            }, 0);

            const totalPaid = currentData.expenses.reduce((sum, expense) => sum + (expense.paid ? expense.amount : 0), 0);
            const remainingBalance = currentData.income - totalExpenses;

            document.getElementById("totalExpenses").textContent = totalExpenses.toFixed(2);
            document.getElementById("totalPaid").textContent = totalPaid.toFixed(2);
            document.getElementById("remainingBalance").textContent = remainingBalance.toFixed(2);
            document.getElementById("currentIncome").textContent = `$${currentData.income.toFixed(2)}`;

            updateExpenseChart();
        }

        // Update expense chart
        function updateExpenseChart() {
            const currentData = dataByMonth[currentMonthIndex];
            const categoryTotals = currentData.expenses.reduce((acc, expense) => {
                if (!expense.skipped) {
                    acc[expense.category] = (acc[expense.category] || 0) + expense.amount;
                }
                return acc;
            }, {});

            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);

            if (expenseChart) {
                expenseChart.destroy();
            }

            const ctx = document.getElementById('expenseChart').getContext('2d');
            expenseChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'white',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(2);
                                    return `${label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update income
        document.getElementById("updateIncomeButton").onclick = () => {
            const income = parseFloat(document.getElementById("incomeInput").value);
            if (isNaN(income) || income <= 0) {
                alert("Please enter a valid income!");
                return;
            }
            dataByMonth[currentMonthIndex].income = income;

            // Carry income to future months
            for (let i = currentMonthIndex + 1; i < 12; i++) {
                if (dataByMonth[i].income === 0) {
                    dataByMonth[i].income = income;
                }
            }

            updateSummary();
            saveData(); // Save changes
        };

        // Initialize
        renderMonthNavbar();
        renderExpensesTable();
        updateSummary();

        // Toggle button text and icon
        document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(button => {
            button.addEventListener('click', function() {
                const icon = this.querySelector('.toggle-icon');
                const isExpanded = this.getAttribute('aria-expanded') === 'true';

                if (isExpanded) {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                } else {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                }
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Prefill the due date with today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('newDueDate').value = today;

            // Initialize Bootstrap tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Format amount input as currency
            const amountInput = document.getElementById('newAmount');
            amountInput.addEventListener('blur', () => {
                const value = parseFloat(amountInput.value);
                if (!isNaN(value)) {
                    amountInput.value = value.toFixed(2);
                }
            });

            // Format income input as currency
            const incomeInput = document.getElementById('incomeInput');
            incomeInput.addEventListener('blur', () => {
                const value = parseFloat(incomeInput.value);
                if (!isNaN(value)) {
                    incomeInput.value = value.toFixed(2);
                }
            });
        });
    </script>
</body>
</html>
